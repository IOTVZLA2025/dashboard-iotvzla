

<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MONITOREO VARIABLES MILLARES</title>
<link rel="icon" href="logo-millares.png" type="image/png">
<link rel="apple-touch-icon" href="logo-millares.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1622" />

<style>
  :root{
    --bg:#071427;
    --card:#0b1220;
    --accent:#00bcd4;
    --muted:#9fb3c8;
    --yellow:#ffca28;
    --orange:#ff9800;
    --danger:#ff1744;
    --ok:#00c853;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:Arial,Helvetica,sans-serif;
    background:#071427;
    color:#e9eef6;
    padding:0;
    margin:0;
    min-height:100vh;
  }

  /* HEADER */
  .header{
    background:#0b1220;
    padding:12px 15px;
    border-bottom:1px solid rgba(255,255,255,0.05);
    position:sticky;
    top:0;
    z-index:100;
  }
  .header-content{
    display:flex;
    align-items:center;
    gap:10px;
    max-width:900px;
    margin:0 auto;
  }
  .header-logo{
    width:40px;
    height:40px;
    border-radius:8px;
    object-fit:contain;
    background:rgba(255,255,255,0.05);
    padding:3px;
    border:1px solid rgba(0,188,212,0.2);
  }
  .header-text{
    flex:1;
  }
  .header-text h1{
    margin:0;
    font-size:16px;
    color:#fff;
  }
  .header-company{
    font-size:13px;
    color:#00bcd4;
    font-weight:600;
    margin-top:2px;
  }
  .header-subtitle{
    font-size:11px;
    color:#9fb3c8;
    margin-top:1px;
  }

  /* CONTENIDO PRINCIPAL */
  .container{
    max-width:900px;
    margin:0 auto;
    padding:15px;
  }

  /* TARJETA PRINCIPAL */
  .card{
    background:#0b1220;
    border-radius:12px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 8px 25px rgba(2,6,23,0.5);
  }

  /* DISEÑO EN GRID */
  .dashboard-grid{
    display:grid;
    grid-template-columns:1fr 320px;
    gap:20px;
  }

  @media(max-width:768px){
    .dashboard-grid{
      grid-template-columns:1fr;
    }
  }

  /* ========== TERMÓMETRO VERTICAL PROFESIONAL ========== */
  .thermometer-container{
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  /* Termómetro principal */
  .thermometer{
    width:80px;
    height:300px;
    background:#0a1525;
    border-radius:40px;
    position:relative;
    border:3px solid rgba(255,255,255,0.08);
    margin-bottom:15px;
    overflow:hidden;
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
  }

  /* Fondo del termómetro */
  .thermometer-bg{
    position:absolute;
    width:100%;
    height:100%;
    background:linear-gradient(to bottom, 
      #003f5c 0%,      /* Azul oscuro abajo */
      #00c853 15%,     /* Verde en -15°C */
      #ffca28 50%,     /* Amarillo en 42.5°C */
      #ff9800 70%,     /* Naranja en 70°C */
      #ff1744 100%     /* Rojo en 100°C */
    );
    opacity:0.15;
  }

  /* Mercurio/indicador */
  .mercury{
    position:absolute;
    bottom:0;
    width:100%;
    height:0%;
    background:linear-gradient(to top, 
      #00c853,          /* Verde base */
      #ffca28,          /* Amarillo medio */
      #ff9800,          /* Naranja */
      #ff1744           /* Rojo top */
    );
    border-radius:40px;
    transition:height 1s ease-in-out;
    box-shadow:inset 0 0 20px rgba(255,255,255,0.2);
  }

  /* Bulbo inferior */
  .thermometer-bulb{
    width:100px;
    height:100px;
    background:linear-gradient(135deg, #0a1525, #1a2535);
    border-radius:50%;
    margin-top:-50px;
    position:relative;
    border:3px solid rgba(255,255,255,0.08);
    box-shadow:0 6px 20px rgba(0,0,0,0.4);
  }

  .bulb-inner{
    width:70px;
    height:70px;
    background:linear-gradient(135deg, #ff1744, #ff9800);
    border-radius:50%;
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    opacity:0.3;
  }

  /* Escala del termómetro */
  .thermometer-scale{
    position:absolute;
    left:calc(100% + 10px);
    top:0;
    height:100%;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    padding:15px 0;
  }

  .scale-mark{
    display:flex;
    align-items:center;
    gap:8px;
  }

  .scale-line{
    width:15px;
    height:2px;
    background:#fff;
    opacity:0.7;
  }

  .scale-number{
    color:#fff;
    font-size:12px;
    font-weight:600;
    min-width:25px;
  }

  /* Temperatura digital grande */
  .temp-display{
    text-align:center;
    margin:20px 0;
  }

  .temp-value{
    font-size:52px;
    font-weight:800;
    color:#ffca28;
    text-shadow:0 3px 15px rgba(255,202,40,0.3);
    line-height:1;
  }

  .temp-unit{
    font-size:28px;
    color:rgba(255,255,255,0.7);
    margin-left:4px;
  }

  .temp-label{
    font-size:14px;
    color:#9fb3c8;
    margin-top:5px;
    font-weight:600;
  }

  /* Info actualización */
  .update-info{
    text-align:center;
    margin-top:15px;
  }

  .update-time{
    font-size:13px;
    color:#9fb3c8;
    padding:8px 15px;
    background:rgba(255,255,255,0.02);
    border-radius:8px;
    display:inline-block;
  }

  .update-note{
    font-size:12px;
    color:#9fb3c8;
    margin-top:8px;
  }

  /* ========== PANEL DERECHO ========== */
  .status-panel{
    display:flex;
    flex-direction:column;
    gap:15px;
  }

  /* Tarjetas de estado */
  .status-card{
    background:rgba(255,255,255,0.02);
    border-radius:12px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.03);
  }

  .status-title{
    font-weight:700;
    font-size:16px;
    margin-bottom:10px;
    color:#fff;
  }

  .status-value{
    font-size:13px;
    color:#9fb3c8;
    margin-bottom:15px;
    min-height:20px;
  }

  /* LEDs grandes */
  .status-led{
    width:80px;
    height:80px;
    border-radius:15px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    font-size:24px;
    box-shadow:0 6px 15px rgba(0,0,0,0.5);
  }

  .led-green{
    background:linear-gradient(135deg,#00c853,#007a2b);
    color:#021;
  }

  .led-red{
    background:linear-gradient(135deg,#ff1744,#a1002b);
    color:#250005;
  }

  .led-yellow{
    background:linear-gradient(135deg,#ffca28,#b37a00);
    color:#2b1a00;
  }

  .led-off{
    background:rgba(255,255,255,0.02);
    color:#9fb3c8;
  }

  /* Banner de alerta */
  .alert-banner{
    padding:12px;
    border-radius:10px;
    text-align:center;
    font-weight:700;
    font-size:15px;
    display:none;
  }

  .alert-alarm{
    background:linear-gradient(90deg,#311000,#6b0000);
    color:#fff;
  }

  .alert-reset{
    background:linear-gradient(90deg,#352e0b,#7a5d00);
    color:#fff;
  }

  /* Info conexión */
  .connection-info{
    display:flex;
    justify-content:space-between;
    font-size:12px;
    color:#9fb3c8;
    margin-top:15px;
    padding-top:15px;
    border-top:1px solid rgba(255,255,255,0.03);
  }

  /* Footer */
  .footer{
    text-align:center;
    font-size:11px;
    color:#9fb3c8;
    margin-top:25px;
    padding-top:20px;
    border-top:1px solid rgba(255,255,255,0.03);
  }

  /* Responsive */
  @media(max-width:768px){
    .container{
      padding:10px;
    }
    .card{
      padding:15px;
    }
    .thermometer{
      width:70px;
      height:250px;
    }
    .thermometer-bulb{
      width:85px;
      height:85px;
      margin-top:-42px;
    }
    .temp-value{
      font-size:44px;
    }
    .header-content{
      flex-direction:column;
      text-align:center;
      gap:8px;
    }
    .header-logo{
      width:36px;
      height:36px;
    }
  }
</style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <img src="logo-millares.png" alt="Logo Millares" class="header-logo">
      <div class="header-text">
        <h1>MONITOREO VARIABLES</h1>
        <div class="header-company">MILLARES BAGB SPA IOT CHILE</div>
        <div class="header-subtitle">Temperatura · Alarma · Reset</div>
      </div>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container">
    <div class="card">
      <div class="dashboard-grid">
        
        <!-- TERMÓMETRO VERTICAL -->
        <div class="thermometer-container">
          <div class="thermometer">
            <div class="thermometer-bg"></div>
            <div class="mercury" id="mercury" style="height:25%"></div>
            <div class="thermometer-scale">
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">100°C</div>
              </div>
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">75°C</div>
              </div>
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">50°C</div>
              </div>
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">25°C</div>
              </div>
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">0°C</div>
              </div>
              <div class="scale-mark">
                <div class="scale-line"></div>
                <div class="scale-number">-15°C</div>
              </div>
            </div>
          </div>
          
          <div class="thermometer-bulb">
            <div class="bulb-inner"></div>
          </div>

          <!-- TEMPERATURA DIGITAL -->
          <div class="temp-display">
            <div class="temp-value" id="tempValue">25.3<span class="temp-unit">°C</span></div>
            <div class="temp-label">TEMPERATURA ACTUAL</div>
          </div>

          <!-- INFO ACTUALIZACIÓN -->
          <div class="update-info">
            <div id="updateTime" class="update-time">Última actualización: --</div>
            <div class="update-note">Actualización automática cada 30 segundos</div>
          </div>
        </div>

        <!-- PANEL DERECHO -->
        <div class="status-panel">
          <div class="status-card">
            <div class="status-title">Estado alarma</div>
            <div id="alarmText" class="status-value">Normal</div>
            <div id="ledAlarm" class="status-led led-green">✓</div>
          </div>

          <div class="status-card">
            <div class="status-title">Reset sistema</div>
            <div id="resetText" class="status-value">No activo</div>
            <div id="ledReset" class="status-led led-off">-</div>
          </div>

          <div id="alarmBanner" class="alert-banner alert-alarm" style="display:none">ALARMA ACTIVADA</div>
          <div id="resetBanner" class="alert-banner alert-reset" style="display:none">RESET RECOMENDADO</div>

          <div class="connection-info">
            <div id="lastPing">Último ping: --</div>
            <div id="connStatus">Conexión: --</div>
          </div>
        </div>
      </div>

      <!-- FOOTER -->
      <div class="footer">
        &copy; 2024 MILLARES BAGB SPA IOT CHILE - Sistema IoT
      </div>
    </div>
  </main>

<script>
// =============================================
// CONFIGURACIÓN
// =============================================
const CONFIG = {
  thingspeak: {
    channelId: '3194050',
    readApiKey: '4L6L63LNFO0YG4BB',
    field: 1,
    url: 'https://api.thingspeak.com/channels/'
  },
  updateInterval: 30000,
  alarmThreshold: 50,
  resetThreshold: 60
};

// =============================================
// OBTENER DATOS DE THINGSPEAK
// =============================================
async function fetchThingSpeakData() {
  const { channelId, readApiKey, field, url } = CONFIG.thingspeak;
  const apiUrl = `${url}${channelId}/fields/${field}/last.json?api_key=${readApiKey}`;
  
  try {
    const response = await fetch(apiUrl);
    if (!response.ok) throw new Error('Error en la respuesta');
    const data = await response.json();
    return parseFloat(data[`field${field}`]) || 0;
  } catch (error) {
    console.error('Error:', error);
    return 25.3;
  }
}

// =============================================
// ACTUALIZAR TERMÓMETRO
// =============================================
function updateThermometer(temp) {
  const mercury = document.getElementById('mercury');
  const tempValue = document.getElementById('tempValue');
  
  // Actualizar valor digital
  tempValue.textContent = temp.toFixed(1);
  
  // Calcular altura del mercurio (-15°C a 100°C = 0% a 100%)
  const minTemp = -15;
  const maxTemp = 100;
  const clampedTemp = Math.max(minTemp, Math.min(maxTemp, temp));
  const percent = (clampedTemp - minTemp) / (maxTemp - minTemp);
  const heightPercent = percent * 100;
  
  // Actualizar altura del mercurio
  mercury.style.height = `${heightPercent}%`;
  
  // Cambiar color del mercurio según temperatura
  if (temp >= 20 && temp <= 30) {
    mercury.style.background = 'linear-gradient(to top, #00c853, #00e676)';
    tempValue.style.color = '#00c853';
  } else if (temp > 30 && temp <= 50) {
    mercury.style.background = 'linear-gradient(to top, #ffca28, #ffd54f)';
    tempValue.style.color = '#ffca28';
  } else if (temp > 50 && temp <= CONFIG.alarmThreshold) {
    mercury.style.background = 'linear-gradient(to top, #ff9800, #ffb74d)';
    tempValue.style.color = '#ff9800';
  } else if (temp > CONFIG.alarmThreshold) {
    mercury.style.background = 'linear-gradient(to top, #ff1744, #ff5252)';
    tempValue.style.color = '#ff1744';
  } else if (temp < 0) {
    mercury.style.background = 'linear-gradient(to top, #00bcd4, #26c6da)';
    tempValue.style.color = '#00bcd4';
  } else {
    mercury.style.background = 'linear-gradient(to top, #00c853, #ffca28)';
    tempValue.style.color = '#ffca28';
  }
  
  return temp;
}

// =============================================
// ACTUALIZAR ESTADOS
// =============================================
function updateStatus(temp) {
  const alarmLed = document.getElementById('ledAlarm');
  const alarmText = document.getElementById('alarmText');
  const resetLed = document.getElementById('ledReset');
  const resetText = document.getElementById('resetText');
  const alarmBanner = document.getElementById('alarmBanner');
  const resetBanner = document.getElementById('resetBanner');
  
  // Alarma
  if (temp > CONFIG.alarmThreshold) {
    alarmLed.className = 'status-led led-red';
    alarmLed.textContent = '!';
    alarmText.textContent = 'ALARMA ACTIVADA';
    alarmText.style.color = '#ff1744';
    alarmBanner.style.display = 'block';
  } else if (temp > 30) {
    alarmLed.className = 'status-led led-yellow';
    alarmLed.textContent = '⚠';
    alarmText.textContent = 'ADVERTENCIA';
    alarmText.style.color = '#ffca28';
    alarmBanner.style.display = 'none';
  } else {
    alarmLed.className = 'status-led led-green';
    alarmLed.textContent = '✓';
    alarmText.textContent = 'Normal';
    alarmText.style.color = '';
    alarmBanner.style.display = 'none';
  }
  
  // Reset
  if (temp > CONFIG.resetThreshold) {
    resetLed.className = 'status-led led-red';
    resetLed.textContent = '!';
    resetText.textContent = 'RESET RECOMENDADO';
    resetText.style.color = '#ff1744';
    resetBanner.style.display = 'block';
  } else {
    resetLed.className = 'status-led led-off';
    resetLed.textContent = '-';
    resetText.textContent = 'No activo';
    resetText.style.color = '';
    resetBanner.style.display = 'none';
  }
}

// =============================================
// ACTUALIZAR TIMESTAMP
// =============================================
function updateTimestamp(success = true) {
  const now = new Date();
  const timeStr = now.toLocaleTimeString('es-CL', { 
    hour: '2-digit', 
    minute: '2-digit',
    second: '2-digit' 
  });
  const dateStr = now.toLocaleDateString('es-CL');
  
  document.getElementById('updateTime').textContent = `Última actualización: ${dateStr} ${timeStr}`;
  document.getElementById('lastPing').textContent = `Ping: ${timeStr}`;
  
  const statusEl = document.getElementById('connStatus');
  if (success) {
    statusEl.textContent = 'Conexión: OK';
    statusEl.style.color = '#00c853';
  } else {
    statusEl.textContent = 'Conexión: ERROR';
    statusEl.style.color = '#ff1744';
  }
}

// =============================================
// FUNCIÓN PRINCIPAL
// =============================================
async function updateDashboard() {
  try {
    const temperature = await fetchThingSpeakData();
    updateThermometer(temperature);
    updateStatus(temperature);
    updateTimestamp(true);
  } catch (error) {
    updateTimestamp(false);
  }
}

// =============================================
// INICIALIZAR
// =============================================
document.addEventListener('DOMContentLoaded', function() {
  updateDashboard();
  setInterval(updateDashboard, CONFIG.updateInterval);
});
</script>
</body>
</html>
